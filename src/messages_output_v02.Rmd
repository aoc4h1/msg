---
title: "Untitled"
output: html_document
date: "2022-09-22"
---

```{r setup, include=FALSE}
library(dplyr)
library(knitr)
library(ggplot2)
library(tidyr)
knitr::opts_knit$set(progress = FALSE, verbose = FALSE)
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
```

<center>
# Hogy is volt ez a Messengeren?
## Több mint 6 év üzenetváltása
</center>
<br />

### Na, lássuk...

![alt text here](/Users/palmamogyorosi/Documents/Palma/Kreatív/2022 Barbi Messenger/_image/1_lassuk.jpg)


```{r napi_adat}
d1 <- data %>% 
  group_by(year,day) %>%
  count()
```

### Mennyi üzenetet váltottunk egy nap?
*Napi üzenetmennyiség 2015.04.22. - 2022.09.17. között*

```{r napi_plot, fig.width=11, fig.height=6.5}
ggplot(d1, aes(x=as.factor(day), y=n, fill=as.factor(year))) + 
  geom_col() +
  scale_fill_brewer(palette = "Spectral",name="") +
  scale_x_discrete(breaks=c("2016-01-01","2017-01-01","2018-01-01","2019-01-02","2020-01-02","2021-04-01","2022-04-01")) +
  theme_minimal() +
  theme(legend.position="bottom",legend.text = element_text(size=11, colour="#404040",margin = margin(r = 30)),
        axis.text = element_text(size=10), axis.text.y = element_text(margin = margin(r = 10)),
        axis.text.x = element_text(margin = margin(t = -5)),
        axis.title = element_blank(), plot.background = element_blank(),
        panel.grid.minor = element_blank(), panel.grid.major = element_blank()) +
  geom_vline(xintercept = "2016-10-01", linetype="dotted", size = 0.7) +
  annotate("text", x = "2016-10-01", y = Inf, label = "Első csók ", angle=90, vjust=2, hjust=1) +
  geom_vline(xintercept = "2018-08-01", linetype="dotted", size = 0.7) +
  annotate("text", x = "2018-08-01", y = Inf, label = "Összeköltözés ", angle=90, vjust=2, hjust=1) +
  geom_vline(xintercept = "2020-03-11", linetype="dotted", size = 0.7) +
  annotate("text", x = "2020-03-11", y = Inf, label = "COVID ", angle=90, vjust=2, hjust=1) +
  annotate("text", x = "2017-03-19", y = 1000, label = "Szülinapi buli másnapja \n (nem voltál ott!)", hjust=-0.1, size=3) +
  annotate("text", x = "2015-10-25", y = 380, label = "Barbi \nDánia", hjust=0.2, size=3) +
  annotate("text", x = "2021-06-27", y = 232, label = "Késik a\nLatorca IC", vjust=-0.7, size=3)
rm(d1)
```

### Minden nap chateltünk egy évben amúgy?
*2016-2021 alapján, ahol 2016 szökőév*

```{r}
d2 <- data %>% group_by(year,day) %>% count() %>% 
  group_by(year) %>% count() %>% mutate(napok=365) %>% filter(year!=2015 & year!=2022)
d2$napok[which(d2$year==2016)] <- 366
d2 <- d2 %>% mutate(pct=n/napok)
d2$pct_nem <- 1-d2$pct

d2_1 <- select(d2,year,pct) %>% mutate(komm="Dumcsiztunk")
d2_2 <- select(d2,year,pct_nem) %>% mutate(komm="Nem dumcsiztunk") %>% rename(pct=pct_nem)
d2 <- rbind(d2_1,d2_2)
rm(d2_1,d2_2)

ggplot(d2, aes(x = year, y = pct, fill = komm)) + 
  geom_col(position = position_stack(reverse = TRUE)) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_brewer(palette = "Set1",name="") +
  theme_minimal() +
  theme(legend.position="bottom",legend.text = element_text(size=11, colour="#404040",margin = margin(r = 30)),
        axis.text = element_text(size=10),
        axis.text.x = element_text(margin = margin(t = -5)),
        axis.title = element_blank(), plot.background = element_blank(),
        panel.grid.minor = element_blank(), panel.grid.major = element_blank())

```


```{r end}
knit2html("messages_output_v02.Rmd")
```

